# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    todo                                               :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: ibouchla <marvin@42.fr>                    +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2016/12/04 22:07:51 by ibouchla          #+#    #+#              #
#    Updated: 2016/12/10 20:48:07 by ibouchla         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

______________
	TODO
______________

				-	aggrégations de descripteurs de fichiers ( ex: "cat file_no_exists 2>&-" )

				-	Finir la norme sur tout les fichiers du projet et de la libft.

				-	CHECKER LES APPELLES DE FONCTION INTERDIT AVEC NM (strlen, printf, strdup...)

				-	Re-implementer mon systeme d'alias

______________
	BUGS
______________

				____________________
					HIGH PRIORITY
				____________________

				-	cmd : "       echo      $PATH               "
					repeter plusieurs fois
					----> malloc error

				-	"env ls" ou "env ./21sh"
					----> le shell quitte

				-	echo $FOO | cat -e repeter tres vite et bcp de fois
					----> ne quitte pas cat

				-	la partie heredoc affiche des char non imprimable sur un simple copier / coller

				-	ctrl + d dans l'heredoc doit signifier fin de lecture et envoyer le resultat
					actuellement il quitte le shell.

				-	unsetenv LC_CTYPE
					ne veut pas a cause du char '_' (underscore)
 
 				-	Pour tout les dquotes, bquote ou quote
 					Quand on copie / colle des caracteres se rajoutent.

				-	cmd : "ls | pwd | wc"
					Ne rend pas le prompt
				
				-	cmd : ""FDP | cat -e"" (Il faut mettre les deux "")
					FDP commande inconnue mais fait quand meme un cat -e
					Bash lui s'arrete des qu'il determine que la commande n'existe pas
					ou qu'elle ne s'est pas exec

				_____________________
					MEDIUM PRIORITY
				_____________________

				-	Le signal STOP ou ctrl + z n'est plus catché,
					lors de la reprise il y a un comportement aléatoire

				-	lancer un 21sh dans un 21sh kill le deuxieme,
					la boucle ignore le signal mais si on ctrl+c
					les couleurs bugs

				-	alias "l= ls -lah | cat -e"
					Envoi "|" "cat" et "-e" en option au ls au lieu de faire un pipe

______________
	LEAKS
______________

				-	ligne de commande compose d'espace uniquement

				-	Grosse commande | ls | cat -e
					jouer avec historique editer etc

					==68382== 25 (24 direct, 1 indirect) bytes in 1 blocks are definitely lost in loss record 70 of 189
					==68382==    at 0x100039671: malloc (in /Users/ibouchla/.brew/Cellar/valgrind/3.12.0/lib/valgrind/vgpreload_memcheck-amd64-darwin.so)
					==68382==    by 0x100018A29: init_gnl (in ./21sh)
					==68382==    by 0x1000189B4: get_next_line (in ./21sh)
					==68382==    by 0x10000AB19: get_history (history.c:74)
					==68382==    by 0x10000BC6E: sh21 (main.c:180)
					==68382==    by 0x10000C007: main (main.c:228)
					==68382==
					==68382== 26 (24 direct, 2 indirect) bytes in 1 blocks are definitely lost in loss record 71 of 189
					==68382==    at 0x100039671: malloc (in /Users/ibouchla/.brew/Cellar/valgrind/3.12.0/lib/valgrind/vgpreload_memcheck-amd64-darwin.so)
					==68382==    by 0x10000B745: insert_arr (main.c:62)
					==68382==    by 0x10000BB43: handle_var (main.c:154)
					==68382==    by 0x10000BC91: sh21 (main.c:182)
					==68382==    by 0x10000C007: main (main.c:228)
					==68382==
					==68382== 28 (24 direct, 4 indirect) bytes in 1 blocks are definitely lost in loss record 74 of 189
					==68382==    at 0x100039671: malloc (in /Users/ibouchla/.brew/Cellar/valgrind/3.12.0/lib/valgrind/vgpreload_memcheck-amd64-darwin.so)
					==68382==    by 0x10000B745: insert_arr (main.c:62)
					==68382==    by 0x10000BB5C: handle_var (main.c:155)
					==68382==    by 0x10000BC91: sh21 (main.c:182)
					==68382==    by 0x10000C007: main (main.c:228)

______________
	BONUS
______________

				-	Syteme d'Alias

				-	Caracteres de controles du builtin echo

				-	Autocompletion

				-	Execution des commandes de maniere asynchrone

				-	Globbing

				-	Builtin 42info

				_	ft_pacman by ibouchla

-----------------------------------------------------------------------------------------------

______________
	RESOLU
______________

	___________________
		LEAKS RESOLU
	___________________

	| RESOLU |	-	Ctrl + R et taper ls pour retrouver la commande.

	| RESOLU |	-	Appuyer sur ENTREE pour valider une commande ou une ligne vide.

	| RESOLU |	-	Fleche du haut, puis ENTREE.

	| RESOLU |	-	Rechercher une commande dans l historique avec les fleches et l'editer

	| RESOLU |	-	ls | wc > toto;

	| RESOLU |	-	alias var=foo;
					alias var=foo2;

	| RESOLU |	-	Ecrire beaucoup beaucoup de contenu dans la ligne de commande avec uen taille de fenetre moyenne
					puis la redimanssionner a volonté, et l'éditer avec une fenetre plus petite qu'au début.

	___________________
		BUGS RESOLU
	___________________

	| RESOLU |	-	L' historique affiche des caracteres chelou apres une commande de plusieurs ligne suite a un oubli de quote.

	| RESOLU |	-	echo "test"jacky doit renvoyer : 'testjacky' et non 'test jacky'
					la commande dois etre pris comme un seul argument meme avec la presence des quotes.

	| RESOLU |	-	lancer la commande ".." suivi d'un ctrl + C
					(pas due exclusivement a la commande ".." mais a toute les commandes qui renvois "execve: Permission denied").

	| RESOLU |	-	"mkdir test ; cd test ; ls -a ; ls | cat | wc -c > fifi ; cat fifi"
					Ne donne pas le resultat attendu dans le sujet.

	| RESOLU |	-	unsetenv / setenv PATH ne produit aucun comportement
					(C'est peut etre juste les modifs d'anis sur l'exec des builtins).

	| RESOLU |	-	"ls ||||"
					Nous avons x3 "21sh: Invalid null command" mais 'ls' est executer.
					Bash lui n'execute pas le 'ls' et nous affiche "syntax error".

	| RESOLU |	-	"base64 /dev/urandom | head -c 1000 | grep 42 | wc -l | sed -e 's/1/Yes/g' -e 's/0/No/g'"
					Le resultat ne sort jamais obliger de ctrl + c
					Le comportement avait ete reproduis en executant dans le 21sh un ./a.out qui segfault volontairement.

	| RESOLU |	-	"cat -e << EOF"
					Nous entrons dans heredoc, ecrivez quelque chose.
					Appuyez sur ENTREE --> Segmentation Fault.

	| RESOLU |	-	JB : après avoir entré cette commande: "glob '*' 'ok' '" le shell va nous proposer de fermer le ' ouvert, puis commande executer,
					tout est normal...
					Mais apres l'history affiche un truc random (ou une ligne vide).
					Serait il possible de remplacer les \n par des espaces tout simplement? ou un "\\n"
	| RESOLU |	-	Ctrl + d
					Si on est sur un char il est supprimer.
					Sinon comportement normal.
	| RESOLU |	-	cmd : "ls |ls" acffiche deux fois ls bug seulement quand le pipe est cole a la deuxieme commande
					(ne bug pas qu avec "ls", meme erreur avec "echo |echo" et parfois ca SEGFAULT

	| RESOLU |	-	cmd : "ls |" execute toujours le ls (on devrais se servir de la fonction quote addapter pour les pipe non ?)

	| RESOLU |	-	cmd : "ls |wc" bug ne kill pas le fils mais surement dut au meme probleme qu au dessus le pipe qui est colle

	| RESOLU |	-	cmd : "echo ;;;;;;;" ------> SEGFAULT

	| RESOLU |	-	cmd : ".." reaffiche le prompt mais n affiche "command not found : .."

	| RESOLU |	-	cmd : "cat" suivit d un ctrl + c affiche 2 fois le prompt

	| RESOLU |	-	lancer quatres ./21sh.
					Faire un kill sur les PID des deux 21sh du milieu.
					Nous avons un comportement indefinis sur l'edition de ligne de cmd.

	| RESOLU |	-	J'avais eu une erreur critique en bombardant le shell de dizaine de millier d'entrée et en jouant en meme
					temps avec la taille de la fenetre, le nombre de leaks bombarder aussi.

	| RESOLU |	-	A chaque fois que la variable d'environnement PATH est modifier / supprimer
					hash_del(&g_hash);
					g_hash = hash_table(new_path);
					Du coup ce sera de nouveau possible que le hash ne trouve pas de correspondance si on unset le PATH !

	| RESOLU |	-	echo "bonjour" | cat -e
					ne fais rien

	| RESOLU |	-	cmd : "history -c" ensuite rechercher dans l historique avec les fleche
					---> SEGFAULT

	| RESOLU |	- 	cmd : "cat $LC_CTYPE"
					En repetant 3/4 fois l'operation nous avons des caracteres aleatoires
					et un malloc erreur
